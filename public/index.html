<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAT SKB PENGAWAS KOPERASI AHLI PERTAMA</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Warna untuk jawaban benar dan salah */
        .correct-answer {
            color: green;
            font-weight: bold;
        }
        .wrong-answer {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div id="question-list" class="question-list"></div>
    </div>
    <div class="content">
                <!-- Progress bar -->
                <div class="progress-button">
                    <div class="progress-container">
                        <div class="progress-bar" id="progress-bar"></div>
                        <div class="progress-percentage" id="progress-percentage">0%</div>
                    </div>
                    <div class="timer-quiz">
                    <div class="timer" id="timer">1:29:49</div>
                    <!-- Tombol Selesai di sebelah kanan -->
                    <button id="end-quiz">SELESAI</button>
                    <!-- Tombol End Quiz -->
                    </div>
                    <!-- Modal Konfirmasi -->
                </div>
                <div class="sub" id="subquestion">-</div>
        <div class="main-content">
        <div id="quiz-container"></div>
    </div>
        <!-- Tombol Simpan Jawaban dan Lewati di sebelah kiri -->
        <div class="nav-buttons">
            <button id="save-answer">SIMPAN DAN LANJUTKAN</button>
            <button id="skip-answer">LEWATKAN</button>
        </div>         
        <div class="nav-buttons-right">
            <div id="confirm-modal" class="modal">
                <div class="modal-content">
                    <h2>Apakah anda ingin mengakhiri ujian?</h2>
                    <p>Jawaban anda akan tersimpan, dan tidak dapat mengubah jawaban.</p>
                    <div class="modal-buttons">
                        <button id="confirm-end" class="confirm-btn">Ya, Akhiri Ujian</button>
                        <button id="cancel-end" class="cancel-btn">Batalkan</button>
                    </div>
                </div>
            </div>
            <div id="score-container" class="score-container" style="display: none;"></div>
        </div>   
    </div>


    <script src="soal.js"></script>
    <script>
        // Fungsi untuk mengacak array secara acak
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // Tukar elemen
            }
        }

        // Acak soal setelah soal diambil dari soal.js
        shuffleArray(questions); // Mengacak urutan soal

        let currentQuestionIndex = 0;
        const userAnswers = [];
        let timerSeconds = 90 * 60; // 90 minutes in seconds
        const quizContainer = document.getElementById('quiz-container');
        const questionList = document.getElementById('question-list');
        const timerElement = document.getElementById('timer');
        const saveButton = document.getElementById('save-answer');
        const skipButton = document.getElementById('skip-answer');
        // Ambil elemen-elemen dari DOM
        const endQuizButton = document.getElementById("end-quiz");
        const confirmModal = document.getElementById("confirm-modal");
        const confirmEndButton = document.getElementById("confirm-end");
        const cancelEndButton = document.getElementById("cancel-end");
        const subsub = document.getElementById("subquestion");


        // Tampilkan modal saat tombol "End Quiz" ditekan
        endQuizButton.addEventListener("click", () => {
            confirmModal.style.display = "flex"; // Tampilkan modal
        });

        // Jika pengguna menekan tombol "Ya, Akhiri Ujian"
        // Jika pengguna menekan tombol "Ya, Akhiri Ujian"
        confirmEndButton.addEventListener("click", () => {
            confirmModal.style.display = "none"; // Sembunyikan modal
            endQuiz(); // Jalankan logika mengakhiri kuis
        });

        // Jika pengguna menekan tombol "Batalkan"
        cancelEndButton.addEventListener("click", () => {
            confirmModal.style.display = "none"; // Sembunyikan modal
            // Tombol "SELESAI" tidak diubah karena quiz tidak diakhiri
        });

        const progressBar = document.getElementById('progress-bar');
        const progressPercentage = document.getElementById('progress-percentage');
        const scoreContainer = document.getElementById('score-container');
        
        let quizEnded = false; // Flag untuk mendeteksi apakah kuis sudah selesai

        // Render satu pertanyaan
        function renderQuestion(index) {
            const questionData = questions[index];
            const userAnswer = userAnswers[index];
            const correctAnswer = questionData.answer;
            const correctAnswerText = questionData.options[correctAnswer - 1]; // Ambil teks dari jawaban benar
            const subquestion = questionData.sub ? questionData.sub : "-";

            let answerFeedback = '';
            if (quizEnded) {
                if (userAnswer === correctAnswer) {
                    answerFeedback = `<p class="correct-answer">Jawaban Anda: ${String.fromCharCode(65 + userAnswer - 1)}. ${questionData.options[userAnswer - 1]}</p>`;
                } else if (userAnswer) {
                    answerFeedback = `<p class="wrong-answer">Jawaban Anda: ${String.fromCharCode(65 + userAnswer - 1)}. ${questionData.options[userAnswer - 1]}</p>`;
                } else {
                    answerFeedback = `<p class="wrong-answer">Jawaban Anda: Tidak Dijawab</p>`;
                }

                answerFeedback += `<p class="">Jawaban Benar: ${String.fromCharCode(65 + correctAnswer - 1)}. ${correctAnswerText}</p>`;
            }
            subsub.innerHTML=`${subquestion}`;
            quizContainer.innerHTML = `
                <div class="question-box">
                    <h4>${index + 1}. ${questionData.question}</h4>
                    <ul class="options">
                        ${questionData.options.map((option, i) => `
                            <li>
                                <label>
                                    ${String.fromCharCode(65 + i)}. 
                                    <input type="radio" name="answer" value="${i + 1}" 
                                        ${userAnswer === (i + 1) ? 'checked' : ''} ${quizEnded ? 'disabled' : ''}> 
                                    ${option}
                                </label>
                            </li>
                        `).join('')}
                    </ul>
                    ${answerFeedback}
                </div>
            `;
        }

        // Render daftar soal
        function renderQuestionList() {
            questionList.innerHTML = '';
            questions.forEach((_, index) => {
                const listItem = document.createElement('div');
                listItem.classList.add('question-item');
                listItem.classList.add(userAnswers[index] !== undefined ? 'answered' : 'unanswered');
                listItem.textContent = index + 1;
                listItem.addEventListener('click', () => {
                    currentQuestionIndex = index;
                    renderQuestion(index);
                });
                questionList.appendChild(listItem);
            });
        }

        // Mulai timer
        function startTimer() {
            const interval = setInterval(() => {
                if (timerSeconds <= 0) {
                    clearInterval(interval);
                    endQuiz();
                } else {
                    timerSeconds--;
                    const hours = Math.floor(timerSeconds / 3600);
                    const minutes = Math.floor((timerSeconds % 3600) / 60);
                    const seconds = timerSeconds % 60;
                    timerElement.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }

        // Perbarui progress bar
        function updateProgressBar() {
            const completedQuestions = userAnswers.filter(answer => answer !== undefined).length;
            const totalQuestions = questions.length;
            const progressPercentageValue = (completedQuestions / totalQuestions) * 100;
            progressBar.style.width = `${progressPercentageValue}%`;
            progressPercentage.textContent = `${Math.round(progressPercentageValue)}%`;
        }

        // Akhiri kuis
        function endQuiz() {
    quizEnded = true;

    const totalQuestions = questions.length;
    const correctAnswers = questions.filter((q, i) => userAnswers[i] === q.answer).length;
    const wrongAnswers = userAnswers.filter((answer, i) => answer !== undefined && answer !== questions[i].answer).length;
    const unanswered = totalQuestions - (correctAnswers + wrongAnswers);

    const score = correctAnswers * 5;
    const maxScore = totalQuestions * 5;

    // Tampilkan skor
    scoreContainer.innerHTML = `
        <p>Skor Anda: <strong>${score} / ${maxScore}</strong></p>
        <p>Analisis Jawaban:</p>
        <ul>
            <li>Benar: <strong>${correctAnswers}</strong></li>
            <li>Salah: <strong>${wrongAnswers}</strong></li>
            <li>Tidak Dijawab: <strong>${unanswered}</strong></li>
        </ul>
    `;
    scoreContainer.style.display = 'block'; // Tampilkan elemen skor

    // Sembunyikan tombol dan elemen lain yang tidak relevan
    saveButton.style.display = 'none';
    endQuizButton.style.display = 'none'; // Tombol SELESAI hanya disembunyikan saat quiz selesai
    timerElement.style.display = 'none';
    skipButton.textContent = 'LANJUTKAN';

    // Render ulang soal aktif dengan jawaban benar
    renderQuestion(currentQuestionIndex);
}



        // Event listeners
        saveButton.addEventListener('click', () => {
            const selectedOption = document.querySelector('input[name="answer"]:checked');
            if (selectedOption) {
                userAnswers[currentQuestionIndex] = parseInt(selectedOption.value, 10);
                renderQuestionList();
                updateProgressBar();
                if (currentQuestionIndex < questions.length - 1) {
                    currentQuestionIndex++;
                    renderQuestion(currentQuestionIndex);
                }
            } else {
                alert('Silakan pilih jawaban sebelum menyimpan.');
            }
        });

        skipButton.addEventListener('click', () => {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion(currentQuestionIndex);
            }
        });

       // endQuizButton.addEventListener('click', endQuiz);

        renderQuestion(currentQuestionIndex);
        renderQuestionList();
        startTimer();
    </script>
</body>
</html>
